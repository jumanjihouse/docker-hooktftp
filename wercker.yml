box: wercker-labs/docker
build:
  steps:
    - install-packages:
        packages: lxc-docker=1.4.1
    - script:
        name: print system-wide docker info
        code: |
          docker version
          docker info
          docker images
    - script:
        name: build images
        code: script/build
    - script:
        name: test the runtime image
        code: script/test
    - script:
        name: tag the runtime image
        code: |
          docker tag hooktftp-runtime:latest jumanjiman/hooktftp:${WERCKER_GIT_COMMIT:0:7}
          docker tag hooktftp-runtime:latest jumanjiman/hooktftp:latest
    - zvelo/docker-save:
        image: jumanjiman/hooktftp:${WERCKER_GIT_COMMIT:0:7}
    - zvelo/docker-save:
        image: jumanjiman/hooktftp:latest
deploy:
  steps:
    - zvelo/docker-hub-push:
        image: jumanjiman/hooktftp:${WERCKER_GIT_COMMIT:0:7}
        email: ${email}
        password: ${password}
        username: jumanjiman
    - zvelo/docker-hub-push:
        image: jumanjiman/hooktftp:latest
        email: ${email}
        password: ${password}
        username: jumanjiman
